<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>OASIS Advanced Message Queuing Protocol (AMQP) Version 1.0, Part 5: Security</title><style type="text/css">
            body {
            margin: 2em;
            padding: 1em;
            font-size: 10.0pt;
            font-family: "DejaVu LGC Sans", "Bitstream Vera Sans", arial, helvetica, sans-serif;
            }
h1
	{margin-top:24.0pt;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:.3in;
	text-indent:-.3in;
	page-break-before:always;
	page-break-after:avoid;
	text-autospace:ideograph-other;
	border:none;
	padding:0in;
	font-size:13.0pt;
	font-family:"Arial","sans-serif";
	color:#3B006F;
	font-weight:bold;}
h2
	{margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.4in;
	margin-bottom:.0001pt;
	text-indent:-.4in;
	page-break-after:avoid;
	text-autospace:ideograph-other;
	font-size:12.0pt;
	font-family:"Arial","sans-serif";
	color:#3B006F;
	font-weight:bold;}
h3
	{margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	text-indent:-.5in;
	page-break-after:avoid;
	text-autospace:ideograph-other;
	font-size:11.0pt;
	font-family:"Arial","sans-serif";
	color:#3B006F;
	font-weight:bold;}
h4
	{margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.6in;
	margin-bottom:.0001pt;
	text-indent:-.6in;
	page-break-after:avoid;
	text-autospace:ideograph-other;
	font-size:10.0pt;
	font-family:"Arial","sans-serif";
	color:#3B006F;
	font-weight:bold;}
h5
	{margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.7in;
	margin-bottom:.0001pt;
	text-indent:-.7in;
	page-break-after:avoid;
	text-autospace:ideograph-other;
	font-size:10.0pt;
	font-family:"Arial","sans-serif";
	color:#3B006F;
	font-weight:bold;}
h6
	{margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.8in;
	margin-bottom:.0001pt;
	text-indent:-.8in;
	page-break-after:avoid;
	text-autospace:ideograph-other;
	font-size:9.0pt;
	font-family:"Arial","sans-serif";
	color:#3B006F;
	font-weight:bold;}
                  
            h1 a, h2 a, h3 a, h4 a {
            color: #3B006F
            }
      
            a {
            text-decoration: none;
            color: #66f;
            }
            
            a.anchor {
            color: #000;
            }
            
            a.toc {
            float: right;
            }
            
            table {
            border-collapse: collapse;
            margin: 1em 1em;
            }
            
            dt {
            font-weight: bold;
            }
            
            dt:after {
            content: ":";
            }
            
            div.toc {
            border: 1px solid #ccc;
            padding: 1em;
            }
            
            table.toc {
            margin: 0;
            }
            
            table.pre {
            background: #eee;
            border: 1px solid #ccc;
            margin-left: auto;
            margin-right: auto;
            }
            
            table.pre td {
            font-family: Courier, monospace;
            font-size:10.0pt;
            white-space: pre;
            padding: 0em 2em;
            }
            
            table.definition {
            width: 100%;
            }
            
            table.signature {
            background: #eee;
            border: 1px solid #ccc;
            width: 100%;
            }
            
            table.signature td {
            font-family: monospace;
            font-size:9.0pt;
            white-space: pre;
            padding: 1em;
            }

            table.encodings th {
            font-size:10.0pt;
            padding: 2px 2em;
            border-bottom-style:solid;
            border-bottom-width:2px;
            text-align:left;
            }

            table.encodings td {
            font-size:10.0pt;
            padding: 2px 2em;
            }
            
            table.constants td {
            font-size:10.0pt;
            padding: 2px 1em;
            }

            table.composite {
            width: 100%;
            }
            
            td.field {
            padding: 0.5em 2em;
            }
            
            div.section {
            padding: 0 0 0 1em;
            }
            
            div.doc {
            padding: 0 0 1em 0;
            }
            
            table.composite div.doc {
            padding: 0;
            }
            
            table.error {
            width: 100%;
            margin: 0;
            }
            
            table.error tr:last-child td {
            padding: 0 0 0 1em;
            }
            
            .todo:before {
            content: "TODO: ";
            font-weight: bold;
            color: red;
            }
            
            .todo {
            font-variant: small-caps;
            font-weight: bold;
            color: red;
            }

p.OasisTitle
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:12.0pt;
	margin-left:0in;
	text-autospace:ideograph-other;
	border:none;
	padding:0in;
	font-size:24.0pt;
	font-family:"Arial","sans-serif";
	color:#3B006F;
	font-weight:bold;}

p.OasisContributor
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	text-autospace:ideograph-other;
	font-size:10.0pt;
	font-family:"Arial","sans-serif";}
a:link, span.OasisHyperlink
	{color:#0000EE;
	text-decoration:none;}
a:visited, span.OasisHyperlinkFollowed
	{color:purple;
	text-decoration:underline;}

p.OasisSubtitle
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:12.0pt;
	margin-left:0in;
	text-autospace:ideograph-other;
	border:none;
	padding:0in;
	font-size:18.0pt;
	font-family:"Arial","sans-serif";
	color:#3B006F;
	font-weight:bold;}
p.OasisTitlePageInfo
	{margin-top:4.3pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	page-break-after:avoid;
	text-autospace:ideograph-other;
	font-size:10.0pt;
	font-family:"Arial","sans-serif";
	color:#3B006F;
	font-weight:bold;}
p.OasisTitlePageInfoDescription
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:4.3pt;
	margin-left:.5in;
	text-autospace:ideograph-other;
	font-size:10.0pt;
	font-family:"Arial","sans-serif";}

        table.RevisionHistory {
            width: 650px;
            }
        table.RevisionHistory th {
            font-size:11.0pt;
            padding: 2px;
            padding-below: 4px;
            color:#3B006F;
            text-align:left;
            font-weight:bold;}
        table.RevisionHistory td.issue {
            width:6em;
            padding-left: 1em;
            vertical-align: top;
            text-align: right}
</style></head><body><img width="203" height="54" src="oasis.jpg"><hr><p class="OasisTitle">OASIS Advanced Message Queuing Protocol (AMQP) Version 1.0<br>
        Part 5: Security</p><p class="OasisSubtitle">OASIS Standard</p><p class="OasisSubtitle">29 October 2012</p><p class="OasisTitlePageInfo"><span style="font-size:12.0pt">Specification URIs</span></p><p class="OasisTitlePageInfo">This version:</p><p class="OasisTitlePageInfoDescription" style="margin-bottom:0in;margin-bottom:.0001pt"><a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-security-v1.0-os.xml">http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-security-v1.0-os.xml</a> (Authoritative)</p><p class="OasisTitlePageInfoDescription" style="margin-bottom:0in;margin-bottom:.0001pt"><a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-security-v1.0-os.html">http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-security-v1.0-os.html</a></p><p class="OasisTitlePageInfoDescription" style="margin-bottom:0in;margin-bottom:.0001pt"><a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-complete-v1.0-os.pdf">http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-complete-v1.0-os.pdf</a></p><p class="OasisTitlePageInfo">Previous version:</p><p class="OasisTitlePageInfoDescription" style="margin-bottom:0in;margin-bottom:.0001pt"><a href="http://docs.oasis-open.org/amqp/core/v1.0/csprd01/amqp-core-security-v1.0-csprd01.xml">http://docs.oasis-open.org/amqp/core/v1.0/csprd01/amqp-core-security-v1.0-csprd01.xml</a> (Authoritative)</p><p class="OasisTitlePageInfoDescription" style="margin-bottom:0in;margin-bottom:.0001pt"><a href="http://docs.oasis-open.org/amqp/core/v1.0/csprd01/amqp-core-security-v1.0-csprd01.html">http://docs.oasis-open.org/amqp/core/v1.0/csprd01/amqp-core-security-v1.0-csprd01.html</a></p><p class="OasisTitlePageInfoDescription" style="margin-bottom:0in;margin-bottom:.0001pt"><a href="http://docs.oasis-open.org/amqp/core/v1.0/csprd01/amqp-core-complete-v1.0-csprd01.pdf">http://docs.oasis-open.org/amqp/core/v1.0/csprd01/amqp-core-complete-v1.0-csprd01.pdf</a></p><p class="OasisTitlePageInfo">Latest version:</p><p class="OasisTitlePageInfoDescription" style="margin-bottom:0in;margin-bottom:.0001pt"><a href="http://docs.oasis-open.org/amqp/core/v1.0/amqp-core-security-v1.0.xml">http://docs.oasis-open.org/amqp/core/v1.0/amqp-core-security-v1.0.xml</a> (Authoritative)</p><p class="OasisTitlePageInfoDescription" style="margin-bottom:0in;margin-bottom:.0001pt"><a href="http://docs.oasis-open.org/amqp/core/v1.0/amqp-core-security-v1.0.html">http://docs.oasis-open.org/amqp/core/v1.0/amqp-core-security-v1.0.html</a></p><p class="OasisTitlePageInfoDescription" style="margin-bottom:0in;margin-bottom:.0001pt"><a href="http://docs.oasis-open.org/amqp/core/v1.0/amqp-core-complete-v1.0.pdf">http://docs.oasis-open.org/amqp/core/v1.0/amqp-core-complete-v1.0.pdf</a></p><p class="OasisTitlePageInfo">Technical Committee:</p><p class="OasisTitlePageInfoDescription" style="margin-bottom:0in;margin-bottom:.0001pt"><a href="http://www.oasis-open.org/committees/amqp/">OASIS Advanced Message Queuing Protocol (AMQP) TC</a></p><p class="OasisTitlePageInfo">Chairs:</p>
  <p class="OasisContributor">Ram Jeyaraman (<span class="OasisHyperlink"><a href="mailto:Ram.Jeyaraman@microsoft.com">Ram.Jeyaraman@microsoft.com</a></span>),
<span class="OasisHyperlink"><a href="http://www.microsoft.com">Microsoft</a></span></p>
  <p class="OasisContributor">Angus Telfer (<span class="OasisHyperlink"><a href="mailto:angus.telfer@inetco.com">angus.telfer@inetco.com</a></span>),
<span class="OasisHyperlink"><a href="http://www.inetco.com">INETCO Systems</a></span></p>
<p class="OasisTitlePageInfo">Editors:</p>
  <p class="OasisContributor">Robert Godfrey (<span class="OasisHyperlink"><a href="mailto:robert.godfrey@jpmorgan.com">robert.godfrey@jpmorgan.com</a></span>),
<span class="OasisHyperlink"><a href="http://www.jpmorganchase.com">JPMorgan Chase &amp; Co.</a></span></p>
  <p class="OasisContributor">David Ingham (<span class="OasisHyperlink"><a href="mailto:David.Ingham@microsoft.com">David.Ingham@microsoft.com</a></span>),
<span class="OasisHyperlink"><a href="http://www.microsoft.com">Microsoft</a></span></p>
  <p class="OasisContributor">Rafael Schloming (<span class="OasisHyperlink"><a href="mailto:rafaels@redhat.com">rafaels@redhat.com</a></span>),
<span class="OasisHyperlink"><a href="http://www.redhat.com">Red Hat</a></span></p>
<p class="OasisTitlePageInfo">Additional artifacts:</p><p class="OasisTitlePageInfoDescription" style="margin-bottom:0in;margin-bottom:.0001pt">This specification consists of the following documents:</p><p class="OasisTitlePageInfoDescription" style="margin-bottom:0in;margin-bottom:.0001pt"><span style="font-family:Symbol">·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="OasisHyperLink"><a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-overview-v1.0-os.html#toc">Part 0: Overview</a></span> - Overview of the AMQP specification</p><p class="OasisTitlePageInfoDescription" style="margin-bottom:0in;margin-bottom:.0001pt"><span style="font-family:Symbol">·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="OasisHyperLink"><a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-types-v1.0-os.html#toc">Part 1: Types</a></span> - AMQP type system and encoding</p><p class="OasisTitlePageInfoDescription" style="margin-bottom:0in;margin-bottom:.0001pt"><span style="font-family:Symbol">·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="OasisHyperLink"><a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-transport-v1.0-os.html#toc">Part 2: Transport</a></span> - AMQP transport layer</p><p class="OasisTitlePageInfoDescription" style="margin-bottom:0in;margin-bottom:.0001pt"><span style="font-family:Symbol">·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="OasisHyperLink"><a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#toc">Part 3: Messaging</a></span> - AMQP Messaging Layer</p><p class="OasisTitlePageInfoDescription" style="margin-bottom:0in;margin-bottom:.0001pt"><span style="font-family:Symbol">·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="OasisHyperLink"><a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-transactions-v1.0-os.html#toc">Part 4: Transactions</a></span> - AMQP Transactions Layer</p><p class="OasisTitlePageInfoDescription" style="margin-bottom:0in;margin-bottom:.0001pt"><span style="font-family:Symbol">·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="OasisHyperLink"><a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-security-v1.0-os.html#toc">Part 5: Security</a></span> (this document) - AMQP Security Layers</p><p class="OasisTitlePageInfoDescription" style="margin-bottom:0in;margin-bottom:.0001pt"><span style="font-family:Symbol">·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="OasisHyperLink"><a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp.dtd">XML Document Type Definition (DTD)</a></span></p><p class="OasisTitlePageInfo">Related work:</p><p class="OasisTitlePageInfoDescription" style="margin-bottom:0in;margin-bottom:.0001pt">This specification replaces or supersedes:</p><p class="OasisTitlePageInfoDescription" style="margin-bottom:0in;margin-bottom:.0001pt"><span style="font-family:Symbol">·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>AMQP v1.0 Final, 07 October 2011. <span class="OasisHyperLink"><a href="http://www.amqp.org/specification/1.0/amqp-org-download">http://www.amqp.org/specification/1.0/amqp-org-download</a></span></p><p class="OasisTitlePageInfo">Abstract:</p>
<p class="OasisTitlePageInfoDescription">The Advanced Message Queuing Protocol (AMQP) is an open internet protocol for business
    messaging. It defines a binary wire-level protocol that allows for the reliable exchange
    of business messages between two parties.
    AMQP has a layered architecture and the specification is organized as a set of parts that
    reflects that architecture. Part 1 defines the AMQP type system and encoding. Part 2 defines
    the AMQP transport layer, an efficient, binary, peer-to-peer protocol for transporting messages
    between two processes over a network. Part 3 defines the AMQP message format, with a
    concrete encoding. Part 4 defines how interactions can be grouped within atomic
    transactions. Part 5 defines the AMQP security layers.</p>
<p class="OasisTitlePageInfo">Status:</p><p class="OasisTitlePageInfoDescription">
This document was last revised or approved by the membership of OASIS on the above date. The level of approval is also listed above. Check the "Latest version" location noted above for possible later revisions of this document.
</p><p class="OasisTitlePageInfoDescription">
Technical Committee members should send comments on this specification to the Technical Committee's email list. Others should send comments to the Technical Committee by using the "<a href="http://www.oasis-open.org/committees/comments/index.php?wg_abbrev=amqp">Send A Comment</a>" button on the Technical Committee's web page at <a href="http://www.oasis-open.org/committees/amqp/">http://www.oasis-open.org/committees/comments/amqp/</a>.
</p><p class="OasisTitlePageInfoDescription">For information on whether any patents have been disclosed that may be essential to implementing this specification, and any offers of patent licensing terms, please refer to the Intellectual Property Rights section of the Technical Committee web page (<a href="http://www.oasis-open.org/committees/amqp/ipr.php">http://www.oasis-open.org/committees/amqp/ipr.php</a>).
</p><p class="OasisTitlePageInfo">Citation format:</p><p class="OasisTitlePageInfoDescription">When referencing this specification the
following citation format should be used:</p><p class="OasisTitlePageInfoDescription"><b><span style="color:black">[amqp-core-security-v1.0]</span></b></p><p class="OasisTitlePageInfoDescription"><i><span style="color:black">OASIS Advanced Message Queuing Protocol (AMQP) Version 1.0 Part 5: Security</span></i><span style="color:black">.
29 October 2012. OASIS Standard. </span><span class="OasisHyperlink"><a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-security-v1.0-os.html">http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-security-v1.0-os.html</a></span><span style="color:black">.</span></p><hr><p class="OasisTitlePageInfo"><span style="font-size:12.0pt">Notices</span></p>
<p class="OasisTitlePageInfoDescription">
  Copyright &copy; OASIS Open 2012. All Rights Reserved.
</p>
<p class="OasisTitlePageInfoDescription">
  All capitalized terms in the following text have the meanings assigned to them in the OASIS
  Intellectual Property Rights Policy (the "OASIS IPR Policy"). The full <a href="http://www.oasis-open.org/policies-guidelines/ipr">Policy</a> may be found at the
  OASIS website.
</p>
<p class="OasisTitlePageInfoDescription">
  This document and translations of it may be copied and furnished to others, and derivative works
  that comment on or otherwise explain it or assist in its implementation may be prepared, copied,
  published, and distributed, in whole or in part, without restriction of any kind, provided that
  the above copyright notice and this section are included on all such copies and derivative works.
  However, this document itself may not be modified in any way, including by removing the copyright
  notice or references to OASIS, except as needed for the purpose of developing any document or
  deliverable produced by an OASIS Technical Committee (in which case the rules applicable to
  copyrights, as set forth in the OASIS IPR Policy, must be followed) or as required to translate
  it into languages other than English.
</p>
<p class="OasisTitlePageInfoDescription">
  The limited permissions granted above are perpetual and will not be revoked by OASIS or its
  successors or assigns.
</p>
<p class="OasisTitlePageInfoDescription">
  This document and the information contained herein is provided on an "AS IS" basis and OASIS
  DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE
  USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY OWNERSHIP RIGHTS OR ANY IMPLIED WARRANTIES OF
  MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.
</p>
<p class="OasisTitlePageInfoDescription">
  OASIS requests that any OASIS Party or any other party that believes it has patent claims that
  would necessarily be infringed by implementations of this OASIS Committee Specification or OASIS
  Standard, to notify OASIS TC Administrator and provide an indication of its willingness to grant
  patent licenses to such patent claims in a manner consistent with the IPR Mode of the OASIS
  Technical Committee that produced this specification.
</p>
<p class="OasisTitlePageInfoDescription">
  OASIS invites any party to contact the OASIS TC Administrator if it is aware of a claim of
  ownership of any patent claims that would necessarily be infringed by implementations of this
  specification by a patent holder that is not willing to provide a license to such patent claims in
  a manner consistent with the IPR Mode of the OASIS Technical Committee that produced this
  specification. OASIS may include such claims on its website, but disclaims any obligation to do
  so.
</p>
<p class="OasisTitlePageInfoDescription">
  OASIS takes no position regarding the validity or scope of any intellectual property or other
  rights that might be claimed to pertain to the implementation or use of the technology described
  in this document or the extent to which any license under such rights might or might not be
  available; neither does it represent that it has made any effort to identify any such rights.
  Information on OASIS' procedures with respect to rights in any document or deliverable produced
  by an OASIS Technical Committee can be found on the OASIS website. Copies of claims of rights
  made available for publication and any assurances of licenses to be made available, or the result
  of an attempt made to obtain a general license or permission for the use of such proprietary
  rights by implementers or users of this OASIS Committee Specification or OASIS Standard, can be
  obtained from the OASIS TC Administrator. OASIS makes no representation that any information or
  list of intellectual property rights will at any time be complete, or that any claims in such list
  are, in fact, Essential Claims.
</p>
<p class="OasisTitlePageInfoDescription">
  The name "OASIS" is a trademark of <a href="http://www.oasis-open.org/">OASIS</a>, the owner and developer of this specification, and
  should be used only to refer to the organization and its official outputs. OASIS welcomes
  reference to, and implementation and use of, specifications, while reserving the right to enforce
  its marks against misleading uses. Please see <a href="http://www.oasis-open.org/policies-guidelines/trademark">http://www.oasis-open.org/policies-guidelines/trademark</a> for above guidance.
</p>
<hr><h2><a name="toc">Table of Contents</a></h2><br><br><table class="toc" summary="Table of Contents">

  <tr><td>5.1 <a href="#section-security-layers">Security Layers</a></td></tr>

  <tr><td>5.2 <a href="#section-tls">TLS</a></td></tr><tr><td>      5.2.1 <a href="#doc-tls-alternative-establishment">Alternative Establishment</a></td></tr><tr><td>      5.2.2 <a href="#definition-idp33024">Constant Definitions</a></td></tr>

  

  <tr><td>5.3 <a href="#section-sasl">SASL</a></td></tr><tr><td>      5.3.1 <a href="#doc-idp43536">SASL Frames</a></td></tr><tr><td>      5.3.2 <a href="#doc-idp51040">SASL Negotiation</a></td></tr><tr><td>      5.3.3 <a href="#doc-idp55200">Security Frame Bodies</a></td></tr><tr><td>            5.3.3.1 <a href="#type-sasl-mechanisms">Sasl Mechanisms</a></td></tr><tr><td>            5.3.3.2 <a href="#type-sasl-init">Sasl Init</a></td></tr><tr><td>            5.3.3.3 <a href="#type-sasl-challenge">Sasl Challenge</a></td></tr><tr><td>            5.3.3.4 <a href="#type-sasl-response">Sasl Response</a></td></tr><tr><td>            5.3.3.5 <a href="#type-sasl-outcome">Sasl Outcome</a></td></tr><tr><td>            5.3.3.6 <a href="#type-sasl-code">Sasl Code</a></td></tr><tr><td>      5.3.4 <a href="#definition-idm36752">Constant Definitions</a></td></tr>

</table><hr>

  <h2><a class="toc" href="#toc">←</a>5.1 <a name="section-security-layers">Security Layers</a></h2><div class="section"><div class="doc"><p>
        Security layers are used to establish an authenticated and/or encrypted transport over which
        regular AMQP traffic can be tunneled. Security layers can be tunneled through one another
        (for instance a security layer used by the peers to do authentication might be tunneled
        through a security layer established for encryption purposes).
      </p><p>
        The framing and protocol definitions for security layers are expected to be defined
        externally to the AMQP specification as in the case of TLS [<a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-overview-v1.0-os.html#anchor-RFC5246">RFC5246</a>]. An exception to this is the SASL [<a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-overview-v1.0-os.html#anchor-RFC4422">RFC4422</a>] security layer which depends on its host protocol to provide
        framing. Therefore <a href="#section-sasl" title="sasl">section 5.3</a> defines the frames necessary for SASL to function.
        When a security layer terminates (either before or after a secure tunnel is established),
        the TCP connection MUST be closed by first shutting down the outgoing stream and then
        reading the incoming stream until it is terminated.
      </p></div></div>

  <h2><a class="toc" href="#toc">←</a>5.2 <a name="section-tls">TLS</a></h2><div class="section"><div class="doc"><p>
        To establish a TLS session, each peer MUST start by sending a protocol header before
        commencing with TLS negotiation. The protocol header consists of the upper case ASCII
        letters "AMQP" followed by a protocol id of two, followed by three unsigned bytes
        representing the major, minor, and revision of the specification version (currently <a href="#definition-TLS-MAJOR">1 (TLS-MAJOR)</a>, <a href="#definition-TLS-MINOR">0 (TLS-MINOR)</a>, <a href="#definition-TLS-REVISION">0 (TLS-REVISION)</a>). In total this is
        an 8-octet sequence:
      </p><table class="pre" summary="Protocol Header for TLS Security Layer"><caption style="caption-side:bottom">Figure 5.1: Protocol Header for TLS Security Layer</caption><tr><td>
  4 OCTETS   1 OCTET   1 OCTET   1 OCTET   1 OCTET
+----------+---------+---------+---------+----------+
|  "AMQP"  |   %d2   |  major  |  minor  | revision |
+----------+---------+---------+---------+----------+
      </td></tr></table><p>
        Other than using a protocol id of two, the exchange of TLS protocol headers follows the same
        rules specified in the version negotiation section of the transport specification (See <a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-transport-v1.0-os.html#section-version-negotiation" title="version-negotiation">section 2.2</a>).
      </p></div><div class="doc"><p>
        The following diagram illustrates the interaction involved in creating a TLS security layer:
      </p><table class="pre" summary="Establishing a TLS Security Layer"><caption style="caption-side:bottom">Figure 5.2: Establishing a TLS Security Layer</caption><tr><td>
TCP Client                 TCP Server
=========================================
AMQP%d2.1.0.0  ---------&gt;
               &lt;---------  AMQP%d2.1.0.0
                    :
                    :
            &lt;TLS negotiation&gt;
                    :
                    :
AMQP%d0.1.0.0  ---------&gt;                (over TLS secured connection)
               &lt;---------  AMQP%d0.1.0.0
         open  ---------&gt;
               &lt;---------  open 
      </td></tr></table><p>
        When the use of the TLS security layer is negotiated, the following rules apply:
      </p><ul>
        <li>
          <p>
            The TLS client peer and TLS server peer are determined by the TCP client peer and TCP
            server peer respectively.
          </p>
        </li>

        <li>
          <p>
            The TLS client peer SHOULD use the server name indication extension as described in
            RFC-4366 [<a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-overview-v1.0-os.html#anchor-RFC4366">RFC4366</a>]. If it does so, then it is undefined what
            happens if this differs from hostname in the <a href="#type-sasl-init">sasl-init</a> and
            <a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-transport-v1.0-os.html#type-open">open</a> frame frames.
          </p>
          <p>
            This field can be used by AMQP proxies to determine the correct back-end service to
            connect the client to, and to determine the domain to validate the client's
            credentials against if TLS client certificates are being used.
          </p>
        </li>

        <li>
          <p>
            The TLS client MUST validate the certificate presented by the TLS server.
          </p>
        </li>

        <li>
          <p>
            Implementations MAY choose to use TLS with unidirectional shutdown, i.e., an application
            initiating shutdown using close_notify is not obliged to wait for the peer to respond,
            and MAY close the write half of the TCP socket.
          </p>
        </li>
      </ul></div><h3><a class="toc" href="#toc">←</a>5.2.1 <a name="doc-tls-alternative-establishment">Alternative Establishment</a></h3><div class="doc"><p>
        In certain situations, such as connecting through firewalls, it might not be possible to
        establish a TLS security layer using the above procedure (for example, because a deep
        packet inspecting firewall sees the first few bytes of the connection 'as not being TLS').
      </p><p>
        As an alternative, implementations MAY run a pure TLS server, i.e., one that does not expect
        the initial TLS-invoking handshake. The IANA service name for this is amqps and the port is
        <a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-transport-v1.0-os.html#definition-SECURE-PORT">SECURE-PORT</a> (5671). Implementations MAY also choose to run this pure TLS
        server on other ports, if this is operationally necessary (e.g., to tunnel through a
        legacy firewall that only expects TLS traffic on port 443).
       </p></div><h3><a class="toc" href="#toc">←</a>5.2.2 <a name="definition-idp33024">Constant Definitions</a></h3><table class="constants"><tr><td><a name="definition-TLS-MAJOR">TLS-MAJOR</a></td><td>1</td><td>major protocol version. </td></tr><tr><td><a name="definition-TLS-MINOR">TLS-MINOR</a></td><td>0</td><td>minor protocol version. </td></tr><tr><td><a name="definition-TLS-REVISION">TLS-REVISION</a></td><td>0</td><td>protocol revision. </td></tr></table></div>

  

  <h2><a class="toc" href="#toc">←</a>5.3 <a name="section-sasl">SASL</a></h2><div class="section"><div class="doc"><p>
        To establish a SASL layer, each peer MUST start by sending a protocol header. The protocol
        header consists of the upper case ASCII letters "AMQP" followed by a protocol id of three,
        followed by three unsigned bytes representing the major, minor, and revision of the
        specification version (currently <a href="#definition-SASL-MAJOR">1 (SASL-MAJOR)</a>, <a href="#definition-SASL-MINOR">0 (SASL-MINOR)</a>, <a href="#definition-SASL-REVISION">0 (SASL-REVISION)</a>). In total this is an 8-octet sequence:
      </p><table class="pre" summary="Protocol Header for SASL Security Layer"><caption style="caption-side:bottom">Figure 5.3: Protocol Header for SASL Security Layer</caption><tr><td>
  4 OCTETS   1 OCTET   1 OCTET   1 OCTET   1 OCTET
+----------+---------+---------+---------+----------+
|  "AMQP"  |   %d3   |  major  |  minor  | revision |
+----------+---------+---------+---------+----------+
      </td></tr></table><p>
        Other than using a protocol id of three, the exchange of SASL layer headers follows the same
        rules specified in the version negotiation section of the transport specification (See <a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-transport-v1.0-os.html#section-version-negotiation" title="version-negotiation">section 2.2</a>).
      </p><p>
        The following diagram illustrates the interaction involved in creating a SASL security
        layer:
      </p><table class="pre" summary="Establishing a SASL Security Layer"><caption style="caption-side:bottom">Figure 5.4: Establishing a SASL Security Layer</caption><tr><td>
TCP Client                 TCP Server
=========================================
AMQP%d3.1.0.0  ---------&gt;
               &lt;---------  AMQP%d3.1.0.0
                    :
                    :
            &lt;SASL negotiation&gt;
                    :
                    :
AMQP%d0.1.0.0  ---------&gt;                (over SASL secured connection)
               &lt;---------  AMQP%d0.1.0.0
         open  ---------&gt;
               &lt;---------  open 
      </td></tr></table></div><h3><a class="toc" href="#toc">←</a>5.3.1 <a name="doc-idp43536">SASL Frames</a></h3><div class="doc"><p>
         SASL performatives are framed as per <a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-transport-v1.0-os.html#section-framing" title="framing">section 2.3</a>. A SASL frame
         has a type code of 0x01. Bytes 6 and 7 of the header are ignored. Implementations SHOULD
         set these to 0x00. The extended header is ignored. Implementations SHOULD therefore set
         DOFF to 0x02.
       </p><table class="pre" summary="SASL Frame"><caption style="caption-side:bottom">Figure 5.5: SASL Frame</caption><tr><td>
              type: 0x01 - SASL frame

           +0       +1       +2       +3
       +-----------------------------------+ -.
     0 |                SIZE               |  |
       +-----------------------------------+  |---&gt; Frame Header
     4 |  DOFF  |  TYPE  |   &lt;IGNORED&gt;*1   |  |      (8 bytes)
       +-----------------------------------+ -'
       +-----------------------------------+ -.
     8 |                ...                |  |
       .                                   .  |---&gt; Extended Header
       .             &lt;IGNORED&gt;*2           .  |  (DOFF * 4 - 8) bytes
       |                ...                |  |
       +-----------------------------------+ -'
       +-----------------------------------+ -.
4*DOFF |                                   |  |
       .                                   .  |
       .                                   .  |
       .    Sasl Mechanisms / Sasl Init    .  |
       .   Sasl Challenge / Sasl Response  .  |---&gt; Frame Body
       .           Sasl Outcome            .  |  (SIZE - DOFF * 4) bytes
       .                                   .  |
       .                                   .  |
       .                           ________|  |
       |                ...       |           |
       +--------------------------+          -'

        *1 SHOULD be set to 0x0000
        *2 Ignored, so DOFF SHOULD be set to 0x02 
      </td></tr></table><p>
        The maximum size of a SASL frame is defined by <a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-transport-v1.0-os.html#definition-MIN-MAX-FRAME-SIZE">MIN-MAX-FRAME-SIZE</a>. There is
        no mechanism within the SASL negotiation to negotiate a different size. The frame body of a
        SASL frame MUST contain exactly one AMQP type, whose type encoding MUST have
         provides="sasl-frame" . Receipt of an empty frame is an irrecoverable error.
      </p></div><h3><a class="toc" href="#toc">←</a>5.3.2 <a name="doc-idp51040">SASL Negotiation</a></h3><div class="doc"><p>
        The peer acting as the SASL server MUST announce supported authentication mechanisms using
        the <a href="#type-sasl-mechanisms">sasl-mechanisms</a> frame. The partner MUST then choose one of the supported
        mechanisms and initiate a sasl exchange.
      </p><table class="pre" summary="SASL Exchange"><caption style="caption-side:bottom">Figure 5.6: SASL Exchange</caption><tr><td>
SASL Client       SASL Server
================================
              &lt;-- SASL-MECHANISMS
SASL-INIT     --&gt;
              ...
              &lt;-- SASL-CHALLENGE *
SASL-RESPONSE --&gt;
              ...
              &lt;-- SASL-OUTCOME
--------------------------------
  * Note that the SASL
    challenge/response step can
    occur zero or more times
    depending on the details of
    the SASL mechanism chosen.
      </td></tr></table><p>
        The peer playing the role of the SASL client and the peer playing the role of the SASL
        server MUST correspond to the TCP client and server respectively.
      </p></div><h3><a class="toc" href="#toc">←</a>5.3.3 <a name="doc-idp55200">Security Frame Bodies</a></h3><div class="doc"></div><h3><a class="toc" href="#toc">←</a>5.3.3.1 <a name="type-sasl-mechanisms">Sasl Mechanisms</a></h3><p>Advertise available sasl mechanisms.</p><table class="signature" summary="@(label)"><tr><td>&lt;type name="sasl-mechanisms" class="composite" source="list" provides="sasl-frame"&gt;
    &lt;descriptor name="amqp:sasl-mechanisms:list" code="0x00000000:0x00000040"/&gt;
    &lt;field name="sasl-server-mechanisms" type="symbol" multiple="true" mandatory="true"/&gt;
&lt;/type&gt;</td></tr></table><div class="doc"><p>
          Advertises the available SASL mechanisms that can be used for authentication.
        </p></div><table class="composite" summary="sasl-mechanisms fields"><tr><td><b>sasl-server-mechanisms</b></td><td><i>supported sasl mechanisms</i></td><td>mandatory <a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-types-v1.0-os.html#type-symbol">symbol</a>[]</td></tr><tr><td class="field" colspan="2"><div class="doc"><p>
            A list of the sasl security mechanisms supported by the sending peer. It is invalid
            for this list to be null or empty. If the sending peer does not require its partner
            to authenticate with it, then it SHOULD send a list of one element with its value as
            the SASL mechanism <i>ANONYMOUS</i>. The server mechanisms are ordered in decreasing
            level of preference.
          </p></div></td></tr></table><h3><a class="toc" href="#toc">←</a>5.3.3.2 <a name="type-sasl-init">Sasl Init</a></h3><p>Initiate sasl exchange.</p><table class="signature" summary="@(label)"><tr><td>&lt;type name="sasl-init" class="composite" source="list" provides="sasl-frame"&gt;
    &lt;descriptor name="amqp:sasl-init:list" code="0x00000000:0x00000041"/&gt;
    &lt;field name="mechanism" type="symbol" mandatory="true"/&gt;
    &lt;field name="initial-response" type="binary"/&gt;
    &lt;field name="hostname" type="string"/&gt;
&lt;/type&gt;</td></tr></table><div class="doc"><p>Selects the sasl mechanism and provides the initial response if needed.</p></div><table class="composite" summary="sasl-init fields"><tr><td><b>mechanism</b></td><td><i>selected security mechanism</i></td><td>mandatory <a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-types-v1.0-os.html#type-symbol">symbol</a></td></tr><tr><td class="field" colspan="2"><div class="doc"><p>
            The name of the SASL mechanism used for the SASL exchange. If the selected mechanism is
            not supported by the receiving peer, it MUST close the connection with the
            authentication-failure close-code. Each peer MUST authenticate using the highest-level
            security profile it can handle from the list provided by the partner.
          </p></div></td></tr><tr><td><b>initial-response</b></td><td><i>security response data</i></td><td>optional <a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-types-v1.0-os.html#type-binary">binary</a></td></tr><tr><td class="field" colspan="2"><div class="doc"><p>
            A block of opaque data passed to the security mechanism. The contents of this data are
            defined by the SASL security mechanism.
          </p></div></td></tr><tr><td><b>hostname</b></td><td><i>the name of the target host</i></td><td>optional <a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-types-v1.0-os.html#type-string">string</a></td></tr><tr><td class="field" colspan="2"><div class="doc"><p>
            The DNS name of the host (either fully qualified or relative) to which the sending peer
            is connecting. It is not mandatory to provide the hostname. If no hostname is provided
            the receiving peer SHOULD select a default based on its own configuration.
          </p><p>
            This field can be used by AMQP proxies to determine the correct back-end service to
            connect the client to, and to determine the domain to validate the client's credentials
            against.
          </p><p>
            This field might already have been specified by the server name indication extension as
            described in RFC-4366 [<a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-overview-v1.0-os.html#anchor-RFC4366">RFC4366</a>], if a TLS layer is used, in
            which case this field SHOULD either be null or contain the same value. It is undefined
            what a different value to those already specified means.
          </p></div></td></tr></table><h3><a class="toc" href="#toc">←</a>5.3.3.3 <a name="type-sasl-challenge">Sasl Challenge</a></h3><p>Security mechanism challenge.</p><table class="signature" summary="@(label)"><tr><td>&lt;type name="sasl-challenge" class="composite" source="list" provides="sasl-frame"&gt;
    &lt;descriptor name="amqp:sasl-challenge:list" code="0x00000000:0x00000042"/&gt;
    &lt;field name="challenge" type="binary" mandatory="true"/&gt;
&lt;/type&gt;</td></tr></table><div class="doc"><p>Send the SASL challenge data as defined by the SASL specification.</p></div><table class="composite" summary="sasl-challenge fields"><tr><td><b>challenge</b></td><td><i>security challenge data</i></td><td>mandatory <a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-types-v1.0-os.html#type-binary">binary</a></td></tr><tr><td class="field" colspan="2"><div class="doc"><p>
            Challenge information, a block of opaque binary data passed to the security
            mechanism.
          </p></div></td></tr></table><h3><a class="toc" href="#toc">←</a>5.3.3.4 <a name="type-sasl-response">Sasl Response</a></h3><p>Security mechanism response.</p><table class="signature" summary="@(label)"><tr><td>&lt;type name="sasl-response" class="composite" source="list" provides="sasl-frame"&gt;
    &lt;descriptor name="amqp:sasl-response:list" code="0x00000000:0x00000043"/&gt;
    &lt;field name="response" type="binary" mandatory="true"/&gt;
&lt;/type&gt;</td></tr></table><div class="doc"><p>Send the SASL response data as defined by the SASL specification.</p></div><table class="composite" summary="sasl-response fields"><tr><td><b>response</b></td><td><i>security response data</i></td><td>mandatory <a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-types-v1.0-os.html#type-binary">binary</a></td></tr><tr><td class="field" colspan="2"><div class="doc"><p>
            A block of opaque data passed to the security mechanism. The contents of this data are
            defined by the SASL security mechanism.
          </p></div></td></tr></table><h3><a class="toc" href="#toc">←</a>5.3.3.5 <a name="type-sasl-outcome">Sasl Outcome</a></h3><p>Indicates the outcome of the sasl dialog.</p><table class="signature" summary="@(label)"><tr><td>&lt;type name="sasl-outcome" class="composite" source="list" provides="sasl-frame"&gt;
    &lt;descriptor name="amqp:sasl-outcome:list" code="0x00000000:0x00000044"/&gt;
    &lt;field name="code" type="sasl-code" mandatory="true"/&gt;
    &lt;field name="additional-data" type="binary"/&gt;
&lt;/type&gt;</td></tr></table><div class="doc"><p>
          This frame indicates the outcome of the SASL dialog. Upon successful completion of the
          SASL dialog the security layer has been established, and the peers MUST exchange protocol
          headers to either start a nested security layer, or to establish the AMQP connection.
        </p></div><table class="composite" summary="sasl-outcome fields"><tr><td><b>code</b></td><td><i>indicates the outcome of the sasl dialog</i></td><td>mandatory <a href="#type-sasl-code">sasl-code</a></td></tr><tr><td class="field" colspan="2"><div class="doc"><p>A reply-code indicating the outcome of the SASL dialog.</p></div></td></tr><tr><td><b>additional-data</b></td><td><i>additional data as specified in RFC-4422</i></td><td>optional <a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-types-v1.0-os.html#type-binary">binary</a></td></tr><tr><td class="field" colspan="2"><div class="doc"><p>
            The additional-data field carries additional data on successful authentication outcome
            as specified by the SASL specification [<a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-overview-v1.0-os.html#anchor-RFC4422">RFC4422</a>].
            If the authentication is unsuccessful, this field is not set.
          </p></div></td></tr></table><h3><a class="toc" href="#toc">←</a>5.3.3.6 <a name="type-sasl-code">Sasl Code</a></h3><p>Codes to indicate the outcome of the sasl dialog.</p><table class="signature" summary="@(label)"><tr><td>&lt;type name="sasl-code" class="restricted" source="ubyte"&gt;
    &lt;choice name="ok" value="0"/&gt;
    &lt;choice name="auth" value="1"/&gt;
    &lt;choice name="sys" value="2"/&gt;
    &lt;choice name="sys-perm" value="3"/&gt;
    &lt;choice name="sys-temp" value="4"/&gt;
&lt;/type&gt;</td></tr></table><table class="composite" summary="possible values"><tr><td><b><a class="anchor" name="choice-sasl-code-ok">ok</a></b></td><td></td><td>0</td></tr><tr><td class="field" colspan="2"><div class="doc"><p>Connection authentication succeeded.</p></div></td></tr><tr><td><b><a class="anchor" name="choice-sasl-code-auth">auth</a></b></td><td></td><td>1</td></tr><tr><td class="field" colspan="2"><div class="doc"><p>
            Connection authentication failed due to an unspecified problem with the supplied
            credentials.
          </p></div></td></tr><tr><td><b><a class="anchor" name="choice-sasl-code-sys">sys</a></b></td><td></td><td>2</td></tr><tr><td class="field" colspan="2"><div class="doc"><p>Connection authentication failed due to a system error.</p></div></td></tr><tr><td><b><a class="anchor" name="choice-sasl-code-sys-perm">sys-perm</a></b></td><td></td><td>3</td></tr><tr><td class="field" colspan="2"><div class="doc"><p>
            Connection authentication failed due to a system error that is unlikely to be corrected
            without intervention.
          </p></div></td></tr><tr><td><b><a class="anchor" name="choice-sasl-code-sys-temp">sys-temp</a></b></td><td></td><td>4</td></tr><tr><td class="field" colspan="2"><div class="doc"><p>
            Connection authentication failed due to a transient system error.
          </p></div></td></tr></table><h3><a class="toc" href="#toc">←</a>5.3.4 <a name="definition-idm36752">Constant Definitions</a></h3><table class="constants"><tr><td><a name="definition-SASL-MAJOR">SASL-MAJOR</a></td><td>1</td><td>major protocol version. </td></tr><tr><td><a name="definition-SASL-MINOR">SASL-MINOR</a></td><td>0</td><td>minor protocol version. </td></tr><tr><td><a name="definition-SASL-REVISION">SASL-REVISION</a></td><td>0</td><td>protocol revision. </td></tr></table></div>

<hr><table width="100%" class="partNav" border="0"><tr><td width="50%" align="left"><a href="http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-transactions-v1.0-os.html#toc">&lt;&lt; Part 4: Transactions</a></td><td width="50%" align="right"></td></tr></table></body></html>
